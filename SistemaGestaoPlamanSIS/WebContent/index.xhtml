<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/templateGeral.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewAction action="#{solicitacaoBean.carregarDados()}" />
	</f:metadata>


	<ui:define name="conteudo">
		<div>
			<h:form id="form">
				<p:panel>
					<div id="info1">
						<p:panel header="Informações do Setor" style="height:280px">
							<p:panel style="background-color:#FFFFFF" rendered="#{solicitacaoBean.qntSolicitacaoAberta != 0}">
								<span class="txtValor">Existem <span
									style="color: blue; font-weight: bold">#{solicitacaoBean.qntSolicitacaoAberta}</span>
									Solicitações em aberto
								</span>
								<p:link outcome="/solicitacaoServico/solicitacoes.xhtml" value="ver solicitações" style="float:right"/>
							</p:panel>
							<!-- APENAS APARECE PARA SUPERVISOR -->
							<p:panel style="background-color:#FFFFFF"
								rendered="#{facesContext.externalContext.isUserInRole('supervisao')}">
								<span class="txtValor"> Existem <span
									style="color: blue; font-weight: bold">#{solicitacaoBean.qntOrdemoAberta}</span>
									ordens de serviço aberta para o seu setor
								</span>
							</p:panel>

						</p:panel>
					</div>

					<div id="info2">
						<p:panel header="Outras Informações" style="height:280px">
							<p:panel style="background-color:#FFFFFF">
								<span class="txtValor">Não há informação</span>
							</p:panel>
						</p:panel>
					</div>

					<div id="info3">
						<p:panel header="Relatorio" style="height:280px">
							<p:panel style="background-color:#FFFFFF">
								<span class="txtValor">Verificar informação que será
									necessario por aqui</span>
							</p:panel>
						</p:panel>
					</div>
					<div class="clear"></div>
				</p:panel>

				<div id="tabelaUltimas">
					<p:panel header="#{facesContext.externalContext.isUserInRole('planejamento')?'Ultimas Ordens Criadas':'Lista de Ordens com Pendencia'}"
					style="min-height:50px;">
						<p:dataTable value="#{solicitacaoBean.ultimasOrdens}" var="item"
							emptyMessage="#{facesContext.externalContext.isUserInRole('planejamento')?'Sem ordens no sistema':'Sem pendencias'}"
							rowStyleClass="linhatabela">
							<p:column style="width:200px">
      							<span class="#{item.tipoOrdem}">#{item.tipoOrdem == 'CORRETIVA' ? 'OSN' : 'OSP'}#{item.id}</span>
							</p:column>
							<p:column >
      							Em Funcionamento: <span class="txtValor">#{item.emFuncionamento ? 'SIM' : 'NAO'}</span>
							</p:column>
							<p:column style="width:300px">
      							Tipo de trabalho: <span class="txtValor">#{item.tipoTrabalho}</span>
							</p:column>
						
							<p:column style="width:250px" rendered="#{facesContext.externalContext.isUserInRole('planejamento')}">
      							Departamento: <span class="txtValor">#{item.setor.nome}</span>
							</p:column>
							<p:column style="width:200px">
      							Status: <span class="#{item.status}">#{item.status}</span>
							</p:column>

							<p:column style="width:170px">
      							Criada Em: <h:outputLabel value="#{item.dataCriacao}"
									styleClass="txtValor">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputLabel>
							</p:column>

							<p:column style="width:20px">
								<p:commandLink oncomplete="PF('dlg').show()" update=":form:modalOrdem">
									<p:graphicImage url="/images/binoculoPreview.png"/>
									<f:setPropertyActionListener value="#{item}"
										target="#{solicitacaoBean.ordemSelecionada}" />
								</p:commandLink>
							</p:column>
						</p:dataTable>

						<p:dialog
							header="Detalhes Ordem"
							widgetVar="dlg" modal="true" height="550px" width="750px"
							id="modalOrdem">
							<p:panelGrid columns="2" columnClasses="txtLabel, txtValor"
								>
								<p:outputLabel value="Ordem: " />
								<h:outputText value="Algum Tipo"/>

								<p:outputLabel value="Status: " />
								<h:outputText value="#{solicitacaoBean.ordemSelecionada.status}" />

								<p:outputLabel value="Data de criação:" />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.dataCriacao}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>

								<p:outputLabel value="Equipamento: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.equipamento}" />

								<p:outputLabel value="Componente: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.componente}" />

								<p:outputLabel value="Em funcionamento: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.emFuncionamento ? 'SIM' : 'NÃO'}" />

								<p:outputLabel value="Departamento: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.setor.nome}" />

								<p:outputLabel value="Ação:" />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.descricaoAcao}" />

							</p:panelGrid>

							<p:panelGrid columns="2" columnClasses="txtLabel, txtValor"
								rendered="#{solicitacaoBean.ordemSelecionada.status == 'ENCERRADO'}">

								<p:outputLabel value="Solução" />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.descricaoSolucao}" />

								<p:outputLabel value="Data de criação:" />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.dataCriacao}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>

								<p:outputLabel value="Iniciado em: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.dataInicio}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>

								<p:outputLabel value="Hora: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.horaInicio}">
									<f:convertDateTime pattern="hh:mm:ss" />
								</h:outputText>

								<p:outputLabel value="Finalizado em: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.dataFinal}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>

								<p:outputLabel value="Hora: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.horaFinal}">
									<f:convertDateTime pattern="hh:mm:ss" />
								</h:outputText>

								<p:outputLabel value="Observação: " />
								<h:outputText
									value="#{solicitacaoBean.ordemSelecionada.observacao}" />
							</p:panelGrid>
						</p:dialog>
					</p:panel>
				</div>
			</h:form>
		</div>
	</ui:define>
</ui:composition>