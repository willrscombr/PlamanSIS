<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head></h:head>
<body>
	<ui:composition>
		<h:form id="frmOrdemDialog">
			<p:dialog widgetVar="modalDetalhesOrdem" id="detalhesOrdem"
				modal="true" header="Detalhes da Ordem" resizable="false"
				closeOnEscape="true">

				<p:panel id="detalhes" rendered="#{ordemServicoBean.programarOs}">
					<p:panelGrid columns="2" columnClasses="txtLabel, txtValor">
						<p:outputLabel value="Ordem: " />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.tipoOrdem}" />

						<p:outputLabel value="Status: " />
						<h:outputText value="#{ordemServicoBean.ordemSelecionada.status}" />

						<p:outputLabel value="Data de criação:" />
							<h:outputText
								value="#{ordemServicoBean.ordemSelecionada.dataCriacao}">
								<f:convertDateTime type="both" dateStyle="medium"/>
							</h:outputText>
						
						<p:outputLabel value="Data de encerramento:" rendered="#{ordemServicoBean.ordemSelecionada.status == 'ENCERRADO'}"/>
						<h:panelGroup rendered="#{ordemServicoBean.ordemSelecionada.status == 'ENCERRADO'}">
							<h:outputText
								value="#{ordemServicoBean.ordemSelecionada.dataHoraEncerramento}">
								<f:convertDateTime type="both" dateStyle="medium"/>
							</h:outputText>
						</h:panelGroup>	
						
						<p:outputLabel value="Equipamento: " />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.equipamento}" />

						<p:outputLabel value="Componente: " />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.componente}" />

						<p:outputLabel value="Em funcionamento: " />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.emFuncionamento ? 'SIM' : 'NÃO'}" />

						<p:outputLabel value="Departamento: " />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.setor.nome}" />

						<p:outputLabel value="Id Solicitacao" />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.id_solicitacao != 0 ? 'SS' : 'N/APLICA'}#{ordemServicoBean.ordemSelecionada.id_solicitacao != 0 ? ordemServicoBean.ordemSelecionada.id_solicitacao : '' }" />
						<p:outputLabel value="Ação:" />
						<h:outputText
							value="#{ordemServicoBean.ordemSelecionada.descricaoAcao}" />


						<p:outputLabel value="Solução"
							rendered="#{ordemServicoBean.ordemSelecionada.status == 'ENCERRADO'
						or ordemServicoBean.ordemSelecionada.status == 'CONFIRMADO'}" />
						<h:outputText
							rendered="#{ordemServicoBean.ordemSelecionada.status == 'ENCERRADO'
						or ordemServicoBean.ordemSelecionada.status == 'CONFIRMADO'}"
							value="#{ordemServicoBean.ordemSelecionada.descricaoSolucao}" />
					</p:panelGrid>

					<p:dataTable
						rendered="#{ordemServicoBean.ordemSelecionada.status == 'CONFIRMADO' or ordemServicoBean.ordemSelecionada.status == 'ENCERRADO'}"
						value="#{ordemServicoBean.ordemSelecionada.confirmacoes}"
						var="confirmacoes" style="width:790px">
						<p:column headerText="Data Inicio">
							<p:outputLabel value="#{confirmacoes.dataInicio}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:outputLabel>
						</p:column>

						<p:column headerText="Hora Inicio">
							<p:outputLabel value="#{confirmacoes.horaInicio} hrs">
								<f:convertDateTime pattern="hh:mm" />
							</p:outputLabel>
						</p:column>

						<p:column headerText="Data Fim">
							<p:outputLabel value="#{confirmacoes.dataFim}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:outputLabel>
						</p:column>

						<p:column headerText="Hora Fim">
							<p:outputLabel value="#{confirmacoes.horaFim} hrs">
								<f:convertDateTime pattern="hh:mm" />
							</p:outputLabel>
						</p:column>

						<p:column headerText="Executor" width="80">
								#{confirmacoes.colaborador.nome}
							</p:column>

					</p:dataTable>


					<f:facet name="footer">
						<p:commandButton value="Programar" update=":frmProgramaOS"
							oncomplete="PF('dlg').show()"
							rendered="#{not facesContext.externalContext.isUserInRole('supervisao') and ordemServicoBean.ordemSelecionada.status == 'ABERTO'}" />
						<p:commandButton value="Mudar para Andamento"
							rendered="#{ordemServicoBean.ordemSelecionada.status == 'IMPRESSO' and not facesContext.externalContext.isUserInRole('supervisao')}" />

						<p:commandButton value="Imprimir"
							action="#{ordemServicoBean.gerarOrdem}"
							onclick="PF('modalDetalhesOrdem').hide(),this.form.target='_blank'"
							ajax="false"
							rendered="#{ordemServicoBean.ordemSelecionada.status == 'PROGRAMADO' and not facesContext.externalContext.isUserInRole('supervisao')}" />

						<p:commandButton value="Confirmar"
							actionListener="#{ordemServicoBean.popularExecutores}"
							rendered="#{ordemServicoBean.ordemSelecionada.status == 'ANDAMENTO' and ordemServicoBean.ordemSelecionada.setor == ordemServicoBean.osService.colaboradorLogado().setor
						or ordemServicoBean.ordemSelecionada.status == 'ANDAMENTO' and facesContext.externalContext.isUserInRole('planejamento')}"
							oncomplete="PF('confirmaDlg').show()" />
						<p:commandButton value="Encerrar TEC" actionListener="#{ordemServicoBean.encerrarOrdem}" update=":frmOrdemDialog"
						rendered="#{ordemServicoBean.ordemSelecionada.status == 'CONFIRMADO' and not facesContext.externalContext.isUserInRole('supervisao')}">
							<p:confirm header="Confirmação" message="Deseja realmente encerrar esta ordem?" icon="ui-icon-alert" />
						</p:commandButton>
						
						<p:commandButton value="Cancelar encerramento TEC?" update=":frmOrdemDialog" rendered="#{facesContext.externalContext.isUserInRole('planejamento') and ordemServicoBean.ordemSelecionada.status == 'ENCERRADO'}">
							<p:confirm header="Confirmação" message="Deseja Cancelar o encerramento TEC?" icon="ui-icon-alert" />
						</p:commandButton>
						
						<p:confirmDialog global="true">
							<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
	        				<p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
						</p:confirmDialog>
					</f:facet>
				</p:panel>
			</p:dialog>
		</h:form>
		<ui:include src="/ordem/modalProgramaOs.xhtml" />
		<ui:include src="/ordem/modalConfirmaOs.xhtml" />
	</ui:composition>
</body>
</html>
