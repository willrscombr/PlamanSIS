
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/templateGeral.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewAction action="#{ordemServicoBean.carregarDados()}" />
	</f:metadata>

	<ui:define name="title_page">Ordens de Serviço</ui:define>

	<ui:define name="conteudo">
		<div style="width: 600xp; background-color: #cccccc">
			<h:form id="frmOrdemPesquisa">
				<p:growl autoUpdate="true" showDetail="true" showSummary="false" />
				<p:panel id="painelPrincipal">
					<p:inputText placeholder="apenas o numero"
						value="#{ordemServicoBean.txtPesquisa}"
						rendered="#{not ordemServicoBean.pesquisaAvancada}"
						style="margin-right:10px;" id="txtPesquisa">
					</p:inputText>

					<p:commandButton
						rendered="#{not ordemServicoBean.pesquisaAvancada}"
						value="Pesquisar" action="#{ordemServicoBean.chamaPesquisa}"
						update=":frmOrdemTabela, txtPesquisa " />

					<p:selectBooleanButton offLabel="(+)Filtros"
						style="margin-bottom:5px;" onLabel="(-)Filtros"
						value="#{ordemServicoBean.pesquisaAvancada}">
						<p:ajax update=":frmOrdemPesquisa" />
					</p:selectBooleanButton>

					<p:panelGrid columns="4" styleClass="filtrosPesquisa" id="avancada"
						rendered="#{ordemServicoBean.pesquisaAvancada}">
						<p:outputLabel value="Componente" for="filtroComponente" />
						<p:inputText value="#{ordemServicoBean.filtros.componente}"
							id="filtroComponente" size="16" />

						<p:outputLabel value="Ciclo Preventivo" for="filtroCiclo" />
						<p:inputText value="#{ordemServicoBean.filtros.ciclo}"
							id="filtroCiclo" size="16">
							<f:convertNumber integerOnly="true" maxIntegerDigits="4" />
						</p:inputText>

						<p:outputLabel value="Status" for="filtroStatus" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.status}"
							id="filtroStatus" style="width:165px">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.statusOrdem()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Centro de Trabalho" for="filtroSetor" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.setor}"
							id="filtroSetor" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.departamentos}"
								var="item" itemLabel="#{item.nome}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Tipo de Trabalho" for="filtroTipo" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.tipoTrabalho}"
							id="filtroTipo" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.tiposTrabalho()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Tipo de Ordem" for="filtroOrdem" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.tipoOrdem}"
							id="filtroOrdem" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.tipoDeOrdem()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>
					</p:panelGrid>
					<p:panelGrid columns="4" id="gridFiltroDatas"
						rendered="#{ordemServicoBean.pesquisaAvancada}">
						<p:outputLabel value="DE" />
						<p:inputMask mask="99/99/9999"
							value="#{ordemServicoBean.filtros.dataInicio}">

							<f:convertDateTime pattern="dd/MM/yyyy" />
						</p:inputMask>

						<p:outputLabel value="ATÉ" />
						<p:inputMask mask="99/99/9999"
							value="#{ordemServicoBean.filtros.dataFinal}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</p:inputMask>
					</p:panelGrid>
					<f:facet name="footer">
						<p:commandButton id="btnPesquisa"
							action="#{ordemServicoBean.pesquisar()}" style="margin-top:5px"
							value="pesquisar" rendered="#{ordemServicoBean.pesquisaAvancada}"
							update=":frmOrdemTabela, :frmOrdemPesquisa" />
					</f:facet>
				</p:panel>
			</h:form>

			<h:form id="frmOrdemTabela">
				<p:panel id="painelOrdem">
					<p:dataTable value="#{ordemServicoBean.ordensDeServico}"
						var="ordem" rows="5" paginator="true" id="tabelaDeOrdem">

						<p:column headerText="ID" style="width:90px;text-align:center">
							<span class="txtLabel">#{ordem.tipoOrdem == 'CORRETIVA' ?
								'OSN' : 'OSP'}#{ordem.id}</span>
						</p:column>

						<p:column headerText="Equipamento"
							style="width:100px;text-align:center">
							<span class="txtValor">#{ordem.equipamento}</span>
						</p:column>

						<p:column headerText="Componente"
							style="width:150px;text-align:center">
							<span class="txtValor">#{ordem.componente}</span>
						</p:column>

						<p:column headerText="Descrição">
							<span class="txtValor">#{ordem.descricaoAcao}</span>
						</p:column>

						<p:column headerText="Setor" style="width:100px;text-align:center"
							rendered="#{facesContext.externalContext.isUserInRole('planejamento')}">
							<span class="txtValor">#{ordem.setor.nome}</span>
						</p:column>

						<p:column headerText="T.Trabalho"
							style="width:90px;text-align:center">
							<span class="txtValor">#{ordem.tipoTrabalho}</span>
						</p:column>

						<p:column headerText="Status" style="width:95px;text-align:center"
							styleClass="#{ordem.status}">
							<span class="txtValor">#{ordem.status}</span>
						</p:column>
						<p:column style="width:60px;">
							<p:commandLink
								actionListener="#{ordemServicoBean.programarExecutor}"
								update=":frmOrdemDialog" oncomplete="PF('modalDetalhesOrdem').show()">
								<p:graphicImage url="/images/lupaview.png" title="ver detalhes" />
								<f:setPropertyActionListener value="#{ordem}"
									target="#{ordemServicoBean.ordemSelecionada}" />
							</p:commandLink>
							<p:spacer width="15px" />
							<h:commandButton action="#{ordemServicoBean.gerarOrdem}"
								onclick="this.form.target='_blank'" image="/images/imprimir.png"
								rendered="#{ordem.status != 'ABERTO' and not facesContext.externalContext.isUserInRole('supervisao')}">
								<f:setPropertyActionListener value="#{ordem}"
									target="#{ordemServicoBean.ordemSelecionada}" />
							</h:commandButton>
						</p:column>
					</p:dataTable>
				</p:panel>
			</h:form>
		</div>
		<div>
			<ui:include src="/ordem/modalDetalhesOs.xhtml" />
		</div>
		

	</ui:define>
</ui:composition>