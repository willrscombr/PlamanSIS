<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/templateGeral.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewAction action="#{solicitacaoBean.carregarDados()}" />
	</f:metadata>

	<ui:define name="title_page">Ordens de Serviço</ui:define>

	<ui:define name="conteudo">
		<h:form id="frmOrdem">
			<p:growl autoUpdate="true" showDetail="true" showSummary="false" />
			<div style="width: 600xp; background-color: #cccccc">
				<p:panel>
					<p:inputText placeholder="apenas o numero" value="#{ordemServicoBean.txtPesquisa}" 
						rendered="#{not ordemServicoBean.pesquisaAvancada}" style="margin-right:10px;" id="txtPesquisa">
					</p:inputText>
					 
					<p:commandButton rendered="#{not ordemServicoBean.pesquisaAvancada}" value="Pesquisar" action="#{ordemServicoBean.chamaPesquisa}" update="tabelaDeOrdem, painelOrdem, txtPesquisa "/>

					<p:selectBooleanButton offLabel="(+)Filtros"
						style="margin-bottom:5px;" onLabel="(-)Filtros"
						value="#{ordemServicoBean.pesquisaAvancada}">
						<p:ajax update="frmOrdem" />
					</p:selectBooleanButton>

					<p:panelGrid columns="4" styleClass="filtrosPesquisa" id="avancada"
						rendered="#{ordemServicoBean.pesquisaAvancada}">
						<p:outputLabel value="Componente" for="filtroComponente" />
						<p:inputText value="#{ordemServicoBean.filtros.componente}"
							id="filtroComponente" size="13" />

						<p:outputLabel value="Status" for="filtroStatus" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.status}"
							id="filtroStatus" style="width:165px">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.statusOrdem()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Setor" for="filtroSetor" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.setor}"
							id="filtroSetor" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.departamentos}"
								var="item" itemLabel="#{item.nome}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Tipo" for="filtroTipo" />
						<p:selectOneMenu value="#{ordemServicoBean.filtros.tipoTrabalho}"
							id="filtroTipo" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.tiposTrabalho()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>
					</p:panelGrid>
					<p:commandButton action="#{ordemServicoBean.pesquisar}" style="margin-top:5px"
							value="pesquisar" rendered="#{ordemServicoBean.pesquisaAvancada}"/>
				</p:panel>

				<p:panel id="painelOrdem">
					<p:dataTable value="#{ordemServicoBean.ordensDeServico}" var="ordem" rows="10" paginator="true" id="tabelaDeOrdem">
					
						<p:column headerText="ID" style="width:50px;text-align:center" >
						 <span class="txtLabel">#{ordem.tipoOrdem == 'CORRETIVA' ? 'OSN' : 'OSP'}#{ordem.id}</span>
						</p:column>

						<p:column headerText="Equipamento" style="width:100px;text-align:center">
							<span class="txtValor">#{ordem.equipamento}</span>
						</p:column>

						<p:column headerText="Componente" style="width:150px;text-align:center">
						<span class="txtValor">#{ordem.componente}</span>
						</p:column>
						
						<p:column headerText="Descrição">
						<span class="txtValor">#{ordem.descricaoAcao}</span>
						</p:column>

						<p:column headerText="Setor" style="width:100px;text-align:center"
							rendered="#{facesContext.externalContext.isUserInRole('planejamento')}">
						<span class="txtValor">#{ordem.setor.nome}</span>
						</p:column>

						<p:column headerText="Tipo Trabalho" style="width:120px;text-align:center">
						<span class="txtValor">#{ordem.tipoTrabalho}</span>
						</p:column>

						<p:column headerText="Data Criação" style="width:120px;text-align:center">
						 <h:outputText styleClass="txtValor" value="#{ordem.dataCriacao}">
						 	<f:convertDateTime pattern="dd/MM/yyyy"/>
						 </h:outputText>
						</p:column>

						<p:column headerText="Status" style="width:95px;text-align:center" styleClass="#{ordem.status}">
							<span class="txtValor">#{ordem.status}</span>
						</p:column>
						<p:column style="width:60px;">
							<p:commandLink>
								<p:graphicImage url="/images/lupaview.png" title="ver detalhes"/>
							</p:commandLink>
							<p:spacer  width="15px"/>
							<p:commandLink>
								<p:graphicImage url="/images/imprimir.png" title="ver detalhes" rendered="#{ordem.status == 'ABERTO'}"/>
							</p:commandLink>
							
						</p:column>
					</p:dataTable>
				</p:panel>
			</div>
		</h:form>
	</ui:define>
</ui:composition>