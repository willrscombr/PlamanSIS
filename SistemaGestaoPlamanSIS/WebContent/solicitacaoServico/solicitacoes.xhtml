<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/templateGeral.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewAction action="#{solicitacaoBean.carregarDados()}" />
	</f:metadata>

	<ui:define name="title_page">Solicitações</ui:define>

	<ui:define name="conteudo">
		<h:form id="frmSolicita">
			<p:growl autoUpdate="true" showDetail="true" showSummary="false"/>
			<div style="width: 600xp; background-color: #cccccc">
				<p:panel id="painelFiltros">
					<p:inputText placeholder="Equipamento"
						rendered="#{not solicitacaoBean.pesquisaAvancada}"
						value="#{solicitacaoBean.filtros.equipamento}"
						style="margin-right:10px;"
						valueChangeListener="#{solicitacaoBean.chamaPesquisa}">
						<f:ajax event="keyup" render=":frmSolicita:panelSolicitacoes" />
					</p:inputText>

					<p:selectBooleanButton offLabel="Mais filtros"
						style="margin-bottom:2px;" onLabel="Menos filtros"
						value="#{solicitacaoBean.pesquisaAvancada}">
						<p:ajax update="frmSolicita" />
					</p:selectBooleanButton>

					<p:panelGrid columns="4" styleClass="filtrosPesquisa" id="avancada"
						rendered="#{solicitacaoBean.pesquisaAvancada}">
						<p:outputLabel value="Componente" for="filtroComponente" />
						<p:inputText value="#{solicitacaoBean.filtros.componente}"
							id="filtroComponente" size="13" />

						<p:outputLabel value="Status" for="filtroStatus" />
						<p:selectOneMenu value="#{solicitacaoBean.filtros.status}"
							id="filtroStatus" style="width:165px">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{solicitacaoBean.todosStatus()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Setor" for="filtroSetor" />
						<p:selectOneMenu value="#{solicitacaoBean.filtros.setor}"
							id="filtroSetor" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{solicitacaoBean.departamentos}"
								var="item" itemLabel="#{item.nome}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:outputLabel value="Tipo" for="filtroTipo" />
						<p:selectOneMenu value="#{solicitacaoBean.filtros.tipoTrabalho}"
							id="filtroTipo" style="width:165px;">
							<f:selectItem itemLabel="selecione" noSelectionOption="true" />
							<f:selectItems value="#{solicitacaoBean.tiposTrabalho()}"
								var="item" itemLabel="#{item}" itemValue="#{item}" />
						</p:selectOneMenu>

						<p:commandButton action="#{solicitacaoBean.pesquisar}"
							value="pesquisar" update="panelSolicitacoes, avancada" />
					</p:panelGrid>
				</p:panel>
			</div>
			<p:panel id="panelSolicitacoes">
				<p:dataTable value="#{solicitacaoBean.solicitacoes}"
					var="solicitacao" id="tabelaSolicita" >
					<p:column headerText="ID" style="width:35px; text-align:center">
									SS#{solicitacao.id}
								</p:column>

					<p:column headerText="EQUIPAMENTO"
						style="width:160px; text-align:center;">
						<span class="txtValor">#{solicitacao.equipamento}</span>
					</p:column>

					<p:column headerText="COMPONENTE"
						style="width:120px; text-align:center">
						<span class="txtValor">#{solicitacao.componente}</span>
					</p:column>

					<p:column headerText="DESCRIÇÃO">
						<span class="txtValor">#{solicitacao.descricaoAcao}</span>
					</p:column>


					<p:column headerText="SETOR"
						rendered="#{facesContext.externalContext.isUserInRole('planejamento')}"
						style="width:80px;">
						<span class="txtValor">#{solicitacao.setor.nome}</span>
					</p:column>


					<p:column headerText="GERADO EM"
						style="width:120px; text-align:center">
						<p:outputLabel value="#{solicitacao.dataCriacao}">
							<f:convertDateTime pattern="dd/MM/yyy" />
						</p:outputLabel>
					</p:column>

					<p:column headerText="STATUS" style="width:80px; text-align:center"
						styleClass="#{solicitacao.status}">
									#{solicitacao.status}
								</p:column>

					<p:column style="width:10px;text-align:center">
						<p:commandLink update=":frmSolicita:modelOrdem"	oncomplete="PF('novaOrdem').show()" rendered="#{facesContext.externalContext.isUserInRole('planejamento')}">
							<p:graphicImage url="/images/mais.png"	rendered="#{solicitacao.status == 'ABERTO'}" />
							<f:setPropertyActionListener value="#{solicitacao}" target="#{ordemServicoBean.solicitacao}" />
							<f:actionListener binding="#{ordemServicoBean.solicitacaoToOrdem()}"/>
						</p:commandLink>
					</p:column>
				</p:dataTable>

				<p:dialog widgetVar="novaOrdem" id="modelOrdem" width="600px"
					height="500px" modal="true" header="Nova Ordem">

					<p:panelGrid columns="2" id="gridNovaOrdem" style="width:550px">
						
						<p:outputLabel value="Tipo de Trabalho"/>
						<p:selectOneMenu value="#{ordemServicoBean.ordemServico.tipoTrabalho}">
							<f:selectItem itemLabel="Selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.tiposTrabalho()}"
								var="item" itemValue="#{item}" />
						</p:selectOneMenu>
						
						<p:outputLabel value="Departamento"/>
						<p:selectOneMenu value="#{ordemServicoBean.ordemServico.setor}">
							<f:selectItem itemLabel="Selecione" noSelectionOption="true" />
							<f:selectItems value="#{ordemServicoBean.departamentos}"
								var="item" itemLabel="#{item.nome}" itemValue="#{item}" />
						</p:selectOneMenu>
						
						<p:outputLabel value="Equipamento"/>
						<p:inputText value="#{ordemServicoBean.ordemServico.equipamento}"/>
						
						<p:outputLabel value="Componente"/>
						<p:inputText value="#{ordemServicoBean.ordemServico.componente}"/>
						
						<p:outputLabel value="Descrição"/>
						<p:inputTextarea value="#{ordemServicoBean.ordemServico.descricaoAcao}" cols="40" rows="5"/>
					</p:panelGrid>
					
					<h:panelGroup >
						
						<p:selectBooleanCheckbox id="emFuncionamento" style="margin-top:15px;text-align:center"
							value="#{ordemServicoBean.ordemServico.emFuncionamento}" required="true" requiredMessage="Responda a pergunta"/>
							<p:spacer width="3px"/>
						<p:outputLabel value="O equipamento esta em funcionamento?" />
						<p:message for="emFuncionamento" />
					</h:panelGroup>
					
					
					<f:facet name="footer">
						<p:commandButton action="#{ordemServicoBean.salvar}" value="Salvar" update="frmSolicita" />
						<p:commandButton value="Imprimir" action="#{ordemServicoBean.imprimir}" update="panelSolicitacoes, tabelaSolicita" />
					</f:facet>
				</p:dialog>
			</p:panel>
		</h:form>
	</ui:define>
</ui:composition>